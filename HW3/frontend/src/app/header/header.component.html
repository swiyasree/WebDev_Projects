<form id="stockform" (ngSubmit)="search_results()" method="get" #stockForm="ngForm">
  <div id="inputWrapper">
    <div class="title-for-form">STOCK SEARCH</div>
    <div class="input-container">
      <input matInput type="text" id="stock_ticker" name="stock_ticker" [matAutocomplete]="auto"
        [(ngModel)]="tickerValue" (input)="onInput()" placeholder="Enter Stock Ticker Symbol" required
        #tickerInput="ngModel" />
      <mat-autocomplete #auto="matAutocomplete" [panelWidth]="autocompleteWidth">
        <mat-option *ngFor="let option of autocompleteOptions" [value]="option.symbol">
          {{ option.symbol }} | {{ option.description }}
        </mat-option>
      </mat-autocomplete>
      <button type="submit" class="search-icon button">
        <i class="bi bi-search"></i>
      </button>
      <button type="button" class="clear-icon button" (click)="clear_results()">
        <i class="bi bi-x"></i>
      </button>
    </div>
  </div>
  <div *ngIf="stockForm.submitted && tickerInput.invalid" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
    Please enter a valid sticker.
    <button type="button" class="close" aria-label="Close" (click)="clearInvalidTicker()">
      <i class="bi bi-x"></i>
    </button>
  </div>
  <div *ngIf="showNoDataMessage" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
    No data found. Please enter a valid Ticker.
  </div>
</form>
<div *ngIf="boughtSymbol" class="alert alert-success alert-dismissible fade show mb-3" role="alert">
  {{ boughtSymbol }} bought successfully.
  <button type="button" class="close" aria-label="Close" (click)="closeboughtMessage()">
    <i class="bi bi-x"></i>
  </button>
</div>

<div *ngIf="soldSymbol" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
  {{ soldSymbol }} sold successfully.
  <button type="button" class="close" aria-label="Close" (click)="closesoldMessage()">
    <i class="bi bi-x"></i>
  </button>
</div>
<div class="center-container">
  <div class="search_data">
    <div *ngIf="submitted && combinedData" class="combined-data">
      <div *ngFor="let searchItem of combinedData.search_result">
        <h3>Description: {{ searchItem.description }}</h3>
        <ul>
          <li>Count: {{ searchItem.count }}</li>
          <li>Display Symbol: {{ searchItem.displaySymbol }}</li>
          <li>Symbol: {{ searchItem.symbol }}</li>
          <li>Type: {{ searchItem.type }}</li>
        </ul>
      </div>
      <div class="profile-info">
        <div class="container">
          <div class="row">
            <div class="col-md-2 profile-data">
              <h1 class="header-with-star">
                {{ combinedData.profile_data.symbol }}
                <span class="star-container" (click)="toggleStar()">
                  <i class="bi bi-star star" [ngClass]="{ filled: isStarFilled, yellow: isStarYellow, black: !isStarYellow }"></i>
                </span>                
              </h1>
              <p>{{ combinedData.profile_data.company_name }}</p>
              <p>{{ combinedData.profile_data.exchange }}</p>
              <div class="button-container">
                <button (click)="buystock()" class="btn btn-success" style="margin-right: 15px;">Buy</button>
                <button (click)="sellstock()" class="btn btn-danger">Sell</button>
              </div>
            </div>
            <div class="col-md-8 logo-data">
              <div class="logo-container">
                <img src="{{ combinedData.profile_data.logo }}" alt="Company Logo" />
              </div>
              <p [style.color]="isMarketOpen() === 'Market is Open' ? 'green' : 'red'">
                {{ isMarketOpen() }}
              </p>
            </div>
            <div class="col-md-2 quote-data">
              <div class="quote-info">
                <h1 [ngClass]="{
                negative: combinedData.quote_data.change < 0,
                positive: combinedData.quote_data.change > 0
              }">
                  {{ combinedData.quote_data.last_price }}
                </h1>
                <h2 [ngClass]="{
                negative: combinedData.quote_data.change < 0,
                positive: combinedData.quote_data.change > 0
              }">
                  <i class="bi bi-caret-up-fill" *ngIf="combinedData.quote_data.change > 0"></i>
                  <i class="bi bi-caret-down-fill" *ngIf="combinedData.quote_data.change < 0"></i>
                  {{ combinedData.quote_data.change }} ({{ combinedData.quote_data.percent_change }}%)
                </h2>
                <p>{{ dateAndtime }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="stockForm.submitted || tickerValue">
      <mat-tab-group #tabGroup [selectedIndex]="0" (selectedTabChange)="handleTabChange($event)">
        <mat-tab label="Summary">
          <ng-template matTabContent>
            <div *ngIf="summaryData" class="tab-content">
              <div class="pricesContainer">
                <p>High Price: {{ summaryData.high_price }}</p>
                <p>Low Price: {{ summaryData.low_price }}</p>
                <p>Open Price: {{ summaryData.open_price }}</p>
                <p>Prev. Price: {{ summaryData.previous_close_price }}</p>
              </div>
              <div class="aboutCaontainer">
                <h3>About the company</h3>
                <p>IPO Start Date: {{ summaryData.company_start_date }}</p>
                <p>Industry: {{ summaryData.company_industry }}</p>
                <p>Company Website URL: <a href="{{ summaryData.company_website_url }}" target="_blank">{{
                    summaryData.company_website_url }}</a></p>
                <div class="peers-container">
                  <h3>Company Peers:</h3>
                  <ul>
                    <ng-container *ngFor="let peer of summaryData.peers; let last = last">
                      <li style="display: inline;">{{ peer }}</li>
                      <span *ngIf="!last">, </span>
                    </ng-container>
                  </ul>
                </div>
              </div>
              <div class="hourlychartContainer">
                <highcharts-chart [Highcharts]="highcharts" [options]="HPchartOptions"
                  style="width: 50%; height: 400px; display: block;">
                </highcharts-chart>
              </div>
            </div>
          </ng-template>
        </mat-tab>
        <mat-tab label="Top News">
          <ng-template matTabContent>
            <div *ngIf="topNewsData" class="card-container">
              <div class="row">
                <div class="col-md-6 mb-4" *ngFor="let newsItem of topNewsData">
                  <div class="card" (click)="openNewsModal(newsItem)">
                    <div class="image-container">
                      <img class="card-img-top" [src]="newsItem.thumbnail" alt="Thumbnail">
                    </div>
                    <div class="card-body">
                      <h5 class="card-title">{{ newsItem.headline }}</h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>
        </mat-tab>
        <mat-tab label="Charts">
          <ng-template matTabContent>
            <div class="tab-content">
              <div id="charts-container"></div>
            </div>
          </ng-template>
        </mat-tab>
        <mat-tab label="Insights">
          <ng-template matTabContent>
            <div *ngIf="insightsData" class="tab-content">
              <div *ngIf="insightsData" class="insights">
                <table>
                  <tr>
                    <th>{{ combinedData.profile_data.company_name }}</th>
                    <th>MSPR</th>
                    <th>Change</th>
                  </tr>
                  <tr>
                    <td style="font-weight: bold;">Total</td>
                    <td>{{ insightsData.Total_MSPR }}</td>
                    <td>{{ insightsData.Total_Change }}</td>
                  </tr>
                  <tr>
                    <td style="font-weight: bold;">Positive</td>
                    <td>{{ insightsData.Positive_MSPR }}</td>
                    <td>{{ insightsData.Positive_Change }}</td>
                  </tr>
                  <tr>
                    <td style="font-weight: bold;">Negative</td>
                    <td>{{ insightsData.Negative_MSPR }}</td>
                    <td>{{ insightsData.Negative_Change }}</td>
                  </tr>
                </table>
                <div style="display: flex;">
                  <highcharts-chart [Highcharts]="highcharts" [options]="chartOptions"
                    style="width: 50%; height: auto; margin: 10px; display: block;">
                  </highcharts-chart>
                  <highcharts-chart [Highcharts]="highcharts" [options]="historicalChartOptions"
                    style="width: 50%; height: auto; margin: 10px; display: block;">
                  </highcharts-chart>
                </div>
              </div>
            </div>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>